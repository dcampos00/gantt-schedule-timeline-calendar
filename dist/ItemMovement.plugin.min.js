!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ItemMovement=e()}(this,(function(){"use strict";const t="undefined"!=typeof PointerEvent;return function(e={}){const n={moveable:!0,resizable:!0,resizerContent:"",collisionDetection:!0,outOfBorders:!1,snapStart:(t,e)=>t+e,snapEnd:(t,e)=>t+e,onDropItem(t){},onDragItem(t){},ghostNode:!0,wait:0};e=Object.assign(Object.assign({},n),e);const i={};function o(n,o){if(!e.moveable&&!e.resizable)return;const r=o.state,s=o.api;function m(t){let n=e.resizable&&(!t.item.hasOwnProperty("resizable")||!0===t.item.resizable);return t.row.hasOwnProperty("resizable")&&n&&(n=t.row.resizable),n}function a(t){const e=t.item.id;return void 0===i[e]&&(i[e]={moving:!1,resizing:!1,waiting:!1}),i[e]}function c(t,e){r.update("config.plugin.ItemMovement.item",Object.assign({id:t},e)),r.update("config.plugin.ItemMovement.movement",t=>(t||(t={moving:!1,waiting:!1,resizing:!1}),t.moving=e.moving,t.waiting=e.waiting,t.resizing=e.resizing,t))}function l(t,i){if(e.ghostNode){const e=a(t),o=i.clientX-e.ganttLeft-e.itemLeftCompensation;e.ghost.style.left=o+"px",e.ghost.style.top=i.clientY-e.ganttTop-e.itemTop+parseInt(getComputedStyle(n)["margin-top"])+"px",c(t.item.id,e)}}function d(t){e.ghostNode&&void 0!==i[t]&&void 0!==i[t].ghost&&(r.get("_internal.elements.chart-timeline").removeChild(i[t].ghost),delete i[t].ghost,c(o.item.id,i[t]))}function u(t){let n=e.snapStart;return"function"==typeof t.item.snapStart&&(n=t.item.snapStart),n}function g(t){let n=e.snapEnd;return"function"==typeof t.item.snapEnd&&(n=t.item.snapEnd),n}const f=`<div class="${s.getClass("chart-timeline-items-row-item-resizer")}">${e.resizerContent}</div>`;n.insertAdjacentHTML("beforeend",f);const p=n.querySelector(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item-resizer");function v(t){const i=s.normalizePointerEvent(t);if(("pointerdown"===t.type||"mousedown"===t.type)&&0!==t.button)return;"function"==typeof e.onDragItem&&e.onDragItem(o);const m=a(o);m.waiting=!0,c(o.item.id,m),setTimeout(()=>{if(t.stopPropagation(),t.preventDefault(),!m.waiting)return;m.moving=!0;const s=r.get(`config.chart.items.${o.item.id}`),l=r.get("_internal.chart.time.leftGlobal"),d=r.get("_internal.chart.time.timePerPixel"),u=r.get("_internal.elements.chart-timeline").getBoundingClientRect();m.ganttTop=u.top,m.ganttLeft=u.left,m.itemX=Math.round((s.time.start-l)/d),m.itemLeftCompensation=i.clientX-m.ganttLeft-m.itemX,c(o.item.id,m),function(t,i,o,s){const m=a(t);if(!e.ghostNode||void 0!==m.ghost)return;const l=n.cloneNode(!0),d=getComputedStyle(n),u=r.get("config.scroll.compensation.y");l.style.position="absolute",l.style.left=i.clientX-o-m.itemLeftCompensation+"px";const g=i.clientY-s-n.offsetTop-u+parseInt(d["margin-top"]);m.itemTop=g,l.style.top=i.clientY-s-g+"px",l.style.width=d.width,l.style["box-shadow"]="10px 10px 6px #00000020";const f=n.clientHeight+"px";l.style.height=f,l.style["line-height"]=n.clientHeight-18+"px",l.style.opacity="0.6",l.style.transform="scale(1.05, 1.05)",r.get("_internal.elements.chart-timeline").appendChild(l),m.ghost=l,c(t.item.id,m)}(o,i,u.left,u.top)},e.wait)}function h(t){if(t.stopPropagation(),t.preventDefault(),("pointerdown"===t.type||"mousedown"===t.type)&&0!==t.button)return;const e=s.normalizePointerEvent(t),n=a(o);n.resizing=!0;const i=r.get(`config.chart.items.${o.item.id}`),m=r.get("_internal.chart.time.leftGlobal"),l=r.get("_internal.chart.time.timePerPixel"),d=r.get("_internal.elements.chart-timeline").getBoundingClientRect();n.ganttTop=d.top,n.ganttLeft=d.left,n.itemX=(i.time.end-m)/l,n.itemLeftCompensation=e.clientX-n.ganttLeft-n.itemX,c(o.item.id,n)}function y(t,n,i,o){if(!e.collisionDetection)return!1;const m=r.get("_internal.chart.time");if(e.outOfBorders&&(i<m.from||o>m.to))return!0;let a=s.time.date(o).diff(i,"milliseconds");if(-1===Math.sign(a)&&(a=-a),a<=1)return!0;const c=r.get("config.list.rows."+t);for(const t of c._internal.items)if(t.id!==n){if(i>=t.time.start&&i<=t.time.end)return!0;if(o>=t.time.start&&o<=t.time.end)return!0;if(i<=t.time.start&&o>=t.time.end)return!0}return!1}function w(t){const n=a(o),i=s.normalizePointerEvent(t);let c,d,f,p,v;(n.moving||n.resizing)&&(t.stopPropagation(),t.preventDefault(),c=r.get(`config.chart.items.${o.item.id}`),d=r.get(`config.chart.items.${o.item.id}.rowId`),f=r.get(`config.list.rows.${d}`),p=r.get("_internal.chart.time.zoom"),v=r.get("_internal.chart.time.timePerPixel"));const h=function(t){let n=e.moveable;return t.item.hasOwnProperty("moveable")&&n&&(n=t.item.moveable),t.row.hasOwnProperty("moveable")&&n&&(n=t.row.moveable),n}(o);if(n.moving){if((!0===h||"x"===h||Array.isArray(h)&&h.includes(d))&&function(t,e,n,i,s){const m=a(o),c=t.clientX-m.ganttLeft-m.itemLeftCompensation;l(o,t);const d=r.get("_internal.chart.time.leftGlobal")+c*s-n.time.start,f=n.time.start,p=u(o)(n.time.start,d,n)-f,v=y(e.id,n.id,n.time.start+p,n.time.end+p);p&&!v&&r.update(`config.chart.items.${o.item.id}.time`,(function(t){return t.start+=p,t.end=g(o)(t.end,p,n)-1,t}))}(i,f,c,0,v),!h||"x"===h)return;let t=function(t,e,n,i,s){l(o,t);const m=a(o),c=t.clientY-m.ganttTop,d=r.get("_internal.list.visibleRows"),u=r.get("config.scroll.compensation.y");let g=0;for(const t of d){if(t.top+u>c)return g>0?g-1:0;g++}return g}(i);const e=r.get("_internal.list.visibleRows");void 0===e[t]&&(t>0?t=e.length-1:t<0&&(t=0));const n=e[t],s=n.id,m=y(s,c.id,c.time.start,c.time.end);s===c.rowId||m||Array.isArray(h)&&!h.includes(s)||n.hasOwnProperty("moveable")&&!n.moveable||r.update(`config.chart.items.${c.id}.rowId`,s)}else!n.resizing||void 0!==c.resizable&&!0!==c.resizable||function(t,e,n,i,s){if(!m(o))return;const c=r.get("_internal.chart.time"),l=a(o),d=t.clientX-l.ganttLeft-l.itemLeftCompensation,f=c.leftGlobal+d*s-n.time.end;if(n.time.end+f<n.time.start)return;const p=n.time.end,v=g(o)(n.time.end,f,n)-1-p,h=y(e.id,n.id,n.time.start,n.time.end+v);v&&!h&&r.update(`config.chart.items.${o.item.id}.time`,t=>(t.start=u(o)(t.start,0,n),t.end=g(o)(t.end,v,n)-1,t))}(i,f,c,0,v)}function b(t){const n=a(o);if(n.moving&&"function"==typeof e.onDropItem&&e.onDropItem(o),n.moving||n.resizing||n.waiting){t.stopPropagation(),t.preventDefault(),n.moving=!1,n.waiting=!1,n.resizing=!1,c(o.item.id,n);for(const t in i)i[t].moving=!1,i[t].resizing=!1,i[t].waiting=!1,d(t)}}return m(o)?p.style.visibility="visible":p.style.visibility="hidden",t?(n.addEventListener("pointerdown",v),p.addEventListener("pointerdown",h),document.addEventListener("pointermove",w),document.addEventListener("pointerup",b)):(n.addEventListener("touchstart",v),p.addEventListener("touchstart",h),document.addEventListener("touchmove",w),document.addEventListener("touchend",b),document.addEventListener("touchcancel",b),n.addEventListener("mousedown",v),p.addEventListener("mousedown",h),document.addEventListener("mousemove",w),document.addEventListener("mouseup",b)),{update(t,e){m(e)||"visible"!==p.style.visibility?m(e)&&"hidden"===p.style.visibility&&(p.style.visibility="visible"):p.style.visibility="hidden",o=e},destroy(e,i){t?(n.removeEventListener("pointerdown",v),p.removeEventListener("pointerdown",h),document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",b)):(n.removeEventListener("mousedown",v),p.removeEventListener("mousedown",h),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",b),n.removeEventListener("touchstart",v),p.removeEventListener("touchstart",h),document.removeEventListener("touchmove",w),document.removeEventListener("touchend",b),document.removeEventListener("touchcancel",b)),p.remove()}}}return function(t){t.state.update("config.actions.chart-timeline-items-row-item",t=>(t.push(o),t))}}}));
